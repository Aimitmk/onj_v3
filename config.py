"""
ゲーム設定・定数定義

役職構成やタイムアウト時間などのゲーム設定を一元管理する。
"""

from game.models import Role

# =============================================================================
# LLM/AI設定
# =============================================================================

# xAI Grok API 設定
# 環境変数:
#   XAI_API_KEY - APIキー（必須）
#   XAI_MODEL   - 使用するモデル（オプション、デフォルト: grok-4-1-fast-reasoning）
# 利用可能: grok-4-1-fast-reasoning, grok-4-1-fast-non-reasoning
XAI_API_URL = "https://api.x.ai/v1/chat/completions"

# LLMプレイヤーの最大人数（1ゲームあたり）
MAX_LLM_PLAYERS = 7

# =============================================================================
# 役職構成（プレイヤー人数ごと）
# =============================================================================
# プレイヤー人数 n に対し、n + 2 枚のカードを使用（プレイヤー用 n 枚 + 中央 2 枚）
#
# バランス考慮のポイント:
# - 3人: 基本にして至高。全員が重要人物で展開が早い
# - 4人: バランス型。村人2人で推理の余白が生まれる
# - 5人: 狂人追加で人狼側とのバランスを調整
# - 6人: 狂人の嘘CO（カミングアウト）が盤面を混乱させる
# - 7人: てるてる（吊り人）でカオス展開。怪しい動きが増える
# - 8人: パーティープレイ。勢いとパッションでの説得が重要

ROLE_CONFIG: dict[int, list[Role]] = {
    # 3人プレイ: 5枚 (3人 + 中央2枚)
    # 人狼2, 占い師1, 怪盗1, 村人1
    # 【基本にして至高】怪盗が人狼を盗むハプニングが起きやすく、推理が白熱
    3: [
        Role.WEREWOLF,
        Role.WEREWOLF,
        Role.SEER,
        Role.THIEF,
        Role.VILLAGER,
    ],
    
    # 4人プレイ: 6枚 (4人 + 中央2枚)
    # 人狼2, 占い師1, 怪盗1, 村人2
    # 【バランス型】基本セットで最もバランスが良い人数
    4: [
        Role.WEREWOLF,
        Role.WEREWOLF,
        Role.SEER,
        Role.THIEF,
        Role.VILLAGER,
        Role.VILLAGER,
    ],
    
    # 5人プレイ: 7枚 (5人 + 中央2枚)
    # 人狼2, 占い師1, 怪盗1, 狂人1, 村人2
    # 【村人増加】狂人を入れて人狼側が有利になりバランスが取れる
    5: [
        Role.WEREWOLF,
        Role.WEREWOLF,
        Role.SEER,
        Role.THIEF,
        Role.MADMAN,
        Role.VILLAGER,
        Role.VILLAGER,
    ],
    
    # 6人プレイ: 8枚 (6人 + 中央2枚)
    # 人狼2, 占い師1, 怪盗1, 狂人1, 村人3
    # 【騙り合いの激化】狂人が嘘の能力者COをして盤面を混乱させるのが鍵
    6: [
        Role.WEREWOLF,
        Role.WEREWOLF,
        Role.SEER,
        Role.THIEF,
        Role.MADMAN,
        Role.VILLAGER,
        Role.VILLAGER,
        Role.VILLAGER,
    ],
    
    # 7人プレイ: 9枚 (7人 + 中央2枚)
    # 人狼2, 占い師1, 怪盗1, 狂人1, 吊り人1, 村人3
    # 【カオス展開】吊り人がわざと怪しい動きをし、推理が非常に難しくなる
    7: [
        Role.WEREWOLF,
        Role.WEREWOLF,
        Role.SEER,
        Role.THIEF,
        Role.MADMAN,
        Role.TANNER,
        Role.VILLAGER,
        Role.VILLAGER,
        Role.VILLAGER,
    ],
    
    # 8人プレイ: 10枚 (8人 + 中央2枚)
    # 人狼2, 占い師1, 怪盗1, 狂人1, 吊り人1, 村人4
    # 【パーティープレイ】論理的な詰めより勢いやパッションでの説得が重要
    8: [
        Role.WEREWOLF,
        Role.WEREWOLF,
        Role.SEER,
        Role.THIEF,
        Role.MADMAN,
        Role.TANNER,
        Role.VILLAGER,
        Role.VILLAGER,
        Role.VILLAGER,
        Role.VILLAGER,
    ],
}

# =============================================================================
# ゲーム設定
# =============================================================================

# プレイヤー人数の制限
MIN_PLAYERS = 3
MAX_PLAYERS = 8

# 中央カードの枚数（常に2枚）
CENTER_CARD_COUNT = 2

# =============================================================================
# タイムアウト設定（秒）
# =============================================================================

# 夜フェーズで各役職が行動を選択するまでの制限時間
NIGHT_ACTION_TIMEOUT = 60

# 昼フェーズの議論時間
DISCUSSION_TIME = 180  # 3分

# 投票の制限時間
VOTE_TIMEOUT = 60

# =============================================================================
# メッセージテンプレート
# =============================================================================

MESSAGES = {
    # ゲーム開始関連
    "game_started": "🐺 **ワンナイト人狼** の参加者を募集中！\n`/onj join` で参加してください。\n現在の参加者: {count}人",
    "player_joined": "✅ {player} さんが参加しました！（現在 {count}人）",
    "player_left": "❌ {player} さんが離脱しました。（現在 {count}人）",
    "game_begin": "🌙 ゲームを開始します！各プレイヤーにDMで役職を通知します...",
    
    # 役職通知
    "role_notification": "🎭 あなたの役職は **{role}** です。\n\n{description}",
    
    # 夜フェーズ
    "night_start": "🌙 **夜になりました...**\n各役職は順番に行動します。DMをご確認ください。",
    "werewolf_alone": "🐺 あなたは唯一の人狼です。他に人狼はいません。",
    "werewolf_partners": "🐺 他の人狼: {partners}",
    "seer_prompt": "🔮 占い師の行動を選んでください：\n• `!seer player @プレイヤー` - 他プレイヤーの役職を見る\n• `!seer center` - 中央カード2枚を見る",
    "thief_prompt": "🦹 怪盗の行動を選んでください：\n• `!thief @プレイヤー` - そのプレイヤーとカードを交換する\n• `!thief skip` - 何もしない",
    
    # 昼フェーズ
    "day_start": "☀️ **朝になりました！**\n{time}秒間、自由に議論してください。\n議論終了後、投票フェーズに移ります。",
    "vote_start": "🗳️ **投票フェーズです！**\n`/onj vote @プレイヤー` で投票してください。\n※自分以外のプレイヤーに投票できます。",
    "vote_received": "✅ {player} さんが投票しました。（{voted}/{total}）",
    
    # 結果発表
    "execution_result": "⚖️ **処刑結果**\n{result}",
    "game_result": "🏆 **ゲーム結果**\n{result}\n\n**勝者**: {winners}",
    "final_roles": "📋 **最終役職**\n{roles}",
    
    # エラー・警告
    "game_already_running": "⚠️ このチャンネルでは既にゲームが進行中です。",
    "not_in_game": "⚠️ ゲームに参加していません。",
    "already_joined": "⚠️ 既にゲームに参加しています。",
    "not_enough_players": "⚠️ プレイヤーが足りません。（最低{min}人必要、現在{current}人）",
    "too_many_players": "⚠️ プレイヤーが多すぎます。（最大{max}人まで）",
    "not_host": "⚠️ このコマンドはホスト（ゲーム開始者）のみ実行できます。",
    "wrong_phase": "⚠️ 現在このコマンドは使用できません。",
    "invalid_target": "⚠️ 無効な対象です。",
    "cannot_vote_self": "⚠️ 自分自身には投票できません。",
    "already_voted": "⚠️ 既に投票済みです。",
}

# =============================================================================
# 役職の説明文
# =============================================================================

ROLE_DESCRIPTIONS = {
    Role.VILLAGER: "特別な能力はありません。議論で人狼を見つけ出しましょう。",
    Role.WEREWOLF: "人狼陣営です。バレないように村人を欺きましょう。",
    Role.ALPHA_WOLF: "人狼陣営です。仲間の人狼を確認でき、さらに中央カードもすべて見れます！",
    Role.SEER: "夜に他プレイヤー1人の役職か、中央カード2枚を見ることができます。",
    Role.THIEF: "夜に他プレイヤー1人とカードを交換できます。交換後の役職があなたの最終役職になります。",
    Role.HUNTER: "自分が処刑された時、夜に指名したプレイヤーを道連れにできます。",
    Role.TANNER: "処刑されることが目的です。自分が処刑されれば単独勝利！",
    Role.MADMAN: "人狼陣営です。人狼が誰かわかりませんが、人狼の勝利を目指しましょう。人狼がいない場合は村人陣営になります。",
    Role.MAYOR: "投票時に2票を持っています。村人陣営として人狼を見つけ出しましょう。",
}

